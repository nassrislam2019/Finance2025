<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>My Finance EGP</title>
    <style>
        /* --- CSS STYLING --- */
        :root {
            --primary: #6366f1;
            --primary-dark: #4338ca;
            --bg-grad-start: #f3f4f6;
            --bg-grad-end: #e0e7ff;
            --card-bg: rgba(255, 255, 255, 0.9);
            --text: #1e293b;
            --text-sub: #64748b;
            --danger: #ef4444;
            --success: #10b981;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* Dark Mode */
        .dark {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --bg-grad-start: #0f172a;
            --bg-grad-end: #1e1b4b;
            --card-bg: rgba(30, 41, 59, 0.85);
            --text: #f1f5f9;
            --text-sub: #94a3b8;
        }

        /* RTL Support */
        [dir="rtl"] { font-family: 'Tahoma', 'Segoe UI', sans-serif; }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: var(--font-main); 
            background: linear-gradient(135deg, var(--bg-grad-start), var(--bg-grad-end));
            background-attachment: fixed; color: var(--text); 
            padding-bottom: 90px; min-height: 100vh;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 16px; }

        /* Typography */
        .text-xl { font-size: 22px; font-weight: 800; }
        .text-lg { font-size: 18px; font-weight: 700; }
        .text-base { font-size: 15px; }
        .text-sm { font-size: 13px; }
        .text-sub { color: var(--text-sub); }
        .bold { font-weight: 700; }

        /* Components */
        .card { 
            background: var(--card-bg); backdrop-filter: blur(12px);
            border-radius: 20px; padding: 20px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
            margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.1);
        }

        .balance-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; position: relative; overflow: hidden;
        }
        .balance-card .text-sub { color: rgba(255,255,255,0.7); }

        .btn { 
            border: none; padding: 12px; border-radius: 12px; 
            font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; 
            gap: 6px; font-size: 14px; width: 100%; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-ghost { background: transparent; color: var(--text); }
        .btn-outline { background: transparent; border: 1px solid var(--text-sub); color: var(--text); }

        /* Navigation */
        nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: var(--card-bg); backdrop-filter: blur(16px);
            border-top: 1px solid rgba(0,0,0,0.05); 
            display: flex; justify-content: space-around; 
            padding: 10px 0 25px 0; z-index: 50; 
        }
        .nav-item { 
            background: none; border: none; display: flex; flex-direction: column; align-items: center; 
            gap: 4px; color: var(--text-sub); font-size: 11px;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 24px; height: 24px; stroke-width: 2px; }

        /* Floating Action Button */
        .fab-container { position: fixed; bottom: 90px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 40; }
        [dir="rtl"] .fab-container { right: auto; left: 20px; }
        
        .fab { 
            width: 56px; height: 56px; border-radius: 20px; 
            background: var(--primary); color: white; border: none; 
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4); 
            font-size: 24px; display: flex; align-items: center; justify-content: center;
        }
        .fab-mini {
            width: 48px; height: 48px; border-radius: 15px;
            background: var(--card-bg); color: var(--text); border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* Inputs */
        .input-group { margin-bottom: 14px; }
        .label { display: block; font-size: 11px; font-weight: 700; color: var(--text-sub); margin-bottom: 6px; text-transform: uppercase; }
        .input { 
            width: 100%; padding: 14px; border-radius: 12px; 
            border: 1px solid rgba(0,0,0,0.1); background: rgba(255,255,255,0.5); 
            color: var(--text); font-size: 16px;
        }
        .dark .input { background: rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.1); }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 100; align-items: center; justify-content: center; padding: 20px; }
        .modal.open { display: flex; }
        .modal-content { 
            background: var(--bg-grad-start); width: 100%; max-width: 400px; 
            border-radius: 24px; padding: 24px; max-height: 90vh; overflow-y: auto; 
        }
        .dark .modal-content { background: #1e293b; }

        /* List Items */
        .tx-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .tx-icon { width: 40px; height: 40px; border-radius: 12px; background: rgba(100,100,100,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px; }
        
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <header class="card" style="border-radius: 0 0 20px 20px; margin-top:0; border-top:none;">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div style="width:32px; height:32px; background:var(--primary); border-radius:8px; display:flex; align-items:center; justify-content:center; color:white;">
                    ðŸ’°
                </div>
                <div class="text-xl bold">My Finance</div>
            </div>
            <div class="flex gap-2">
                <button class="btn-ghost" onclick="toggleLang()" style="width:auto; padding:0 8px;">ðŸ‡ºðŸ‡¸/ðŸ‡ªðŸ‡¬</button>
                <button class="btn-ghost" onclick="toggleTheme()" style="width:32px;">ðŸŒ—</button>
            </div>
        </div>
    </header>

    <div id="mainContainer" class="container"></div>

    <div class="fab-container">
        <button class="fab fab-mini" onclick="openTransferModal()" title="Transfer">â‡„</button>
        <button class="fab" onclick="openTxModal()" title="Add Transaction">ï¼‹</button>
    </div>

    <nav>
        <button class="nav-item active" onclick="switchView('dashboard')" id="nav-dash">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <span data-i18n="home">Home</span>
        </button>
        <button class="nav-item" onclick="switchView('transactions')" id="nav-tx">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 17l-5-5 5-5"/><path d="M20 12H4"/></svg>
            <span data-i18n="history">History</span>
        </button>
        <button class="nav-item" onclick="switchView('settings')" id="nav-set">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            <span data-i18n="settings">Settings</span>
        </button>
    </nav>

    <div id="txModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center" style="margin-bottom:20px;">
                <h2 class="text-xl" data-i18n="addTx">Add Transaction</h2>
                <button class="btn-ghost" onclick="closeModal('txModal')">âœ•</button>
            </div>
            
            <div class="flex gap-2" style="background:rgba(0,0,0,0.05); padding:4px; border-radius:12px; margin-bottom:16px;">
                <button class="btn" id="btn-exp" onclick="setTxType('exp')" style="background:var(--danger); color:white;">Expense</button>
                <button class="btn btn-ghost" id="btn-inc" onclick="setTxType('inc')">Income</button>
            </div>

            <div class="input-group">
                <label class="label" data-i18n="amount">Amount</label>
                <input type="number" id="txAmount" class="input" placeholder="0.00" inputmode="decimal">
            </div>
            <div class="input-group">
                <label class="label" data-i18n="wallet">Wallet</label>
                <select id="txAccount" class="input"></select>
            </div>
            <div class="input-group">
                <label class="label" data-i18n="category">Category</label>
                <select id="txCategory" class="input"></select>
            </div>
            <div class="input-group">
                <label class="label" data-i18n="desc">Description</label>
                <input type="text" id="txDesc" class="input">
            </div>
            <button class="btn btn-primary" onclick="saveTransaction()" data-i18n="save">Save</button>
        </div>
    </div>

    <div id="transferModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center" style="margin-bottom:20px;">
                <h2 class="text-xl" data-i18n="transfer">Transfer</h2>
                <button class="btn-ghost" onclick="closeModal('transferModal')">âœ•</button>
            </div>
            <div class="input-group">
                <label class="label" data-i18n="amount">Amount</label>
                <input type="number" id="trAmount" class="input" placeholder="0.00">
            </div>
            <div class="input-group">
                <label class="label" data-i18n="from">From</label>
                <select id="trFrom" class="input"></select>
            </div>
            <div class="input-group">
                <label class="label" data-i18n="to">To</label>
                <select id="trTo" class="input"></select>
            </div>
            <button class="btn btn-primary" onclick="saveTransfer()" data-i18n="save">Confirm Transfer</button>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        let lang = localStorage.getItem('mf_lang') || 'en';
        let currency = 'EGP';
        
        let accounts = JSON.parse(localStorage.getItem('mf_accounts')) || [
            { id: 1, name: "Cash", type: "cash", balance: 0 },
            { id: 2, name: "Vodafone Cash", type: "digital", balance: 0 },
            { id: 3, name: "Bank / InstaPay", type: "bank", balance: 0 }
        ];

        let transactions = JSON.parse(localStorage.getItem('mf_tx')) || [];
        let txType = 'exp';

        // --- TRANSLATIONS (English / Arabic) ---
        const i18n = {
            en: {
                home: "Home", history: "History", settings: "Settings",
                balance: "Total Balance", income: "Income", expense: "Expenses",
                addTx: "Add Transaction", transfer: "Transfer", 
                amount: "Amount", wallet: "Wallet", category: "Category",
                desc: "Description", save: "Save", from: "From", to: "To",
                recent: "Recent Transactions", reset: "Reset Data",
                export: "Export Data"
            },
            ar: {
                home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", history: "Ø§Ù„Ø³Ø¬Ù„", settings: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
                balance: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯", income: "Ø¯Ø®Ù„", expense: "Ù…ØµØ±ÙˆÙØ§Øª",
                addTx: "Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø©", transfer: "ØªØ­ÙˆÙŠÙ„", 
                amount: "Ø§Ù„Ù…Ø¨Ù„Øº", wallet: "Ø§Ù„Ù…Ø­ÙØ¸Ø©", category: "Ø§Ù„ØªØµÙ†ÙŠÙ",
                desc: "Ø§Ù„ÙˆØµÙ", save: "Ø­ÙØ¸", from: "Ù…Ù†", to: "Ø¥Ù„Ù‰",
                recent: "Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª", reset: "Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
                export: "ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
            }
        };

        const categories = {
            exp: ["ðŸ” Food", "ðŸš• Transport", "ðŸ  Rent", "ðŸ›’ Groceries", "ðŸ“± Bills", "ðŸ’Š Health"],
            inc: ["ðŸ’¸ Salary", "ðŸ“ˆ Bonus", "ðŸŽ Gift", "ðŸ’¼ Freelance"]
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            updateLangAttrs();
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
            switchView('dashboard');
        });

        // --- VIEW ENGINE ---
        function switchView(view) {
            const container = document.getElementById('mainContainer');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            if(view === 'dashboard') {
                document.getElementById('nav-dash').classList.add('active');
                renderDashboard(container);
            } else if(view === 'transactions') {
                document.getElementById('nav-tx').classList.add('active');
                renderHistory(container);
            } else if(view === 'settings') {
                document.getElementById('nav-set').classList.add('active');
                renderSettings(container);
            }
            applyTranslations();
        }

        function renderDashboard(target) {
            const totalBalance = accounts.reduce((sum, acc) => sum + acc.balance, 0);
            const inc = transactions.filter(t => t.type === 'inc').reduce((sum, t) => sum + t.amount, 0);
            const exp = transactions.filter(t => t.type === 'exp').reduce((sum, t) => sum + t.amount, 0);

            let accountsHtml = accounts.map(acc => `
                <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid rgba(0,0,0,0.05);">
                    <div class="flex items-center gap-2">
                        <span>${acc.name.includes('Vodafone') ? 'ðŸ“±' : acc.name.includes('Bank') ? 'ðŸ’³' : 'ðŸ’µ'}</span>
                        <span class="text-sm bold">${acc.name}</span>
                    </div>
                    <span class="text-sm bold">${formatMoney(acc.balance)}</span>
                </div>
            `).join('');

            target.innerHTML = `
                <div class="card balance-card">
                    <div class="text-sub" data-i18n="balance">${i18n[lang].balance}</div>
                    <div class="text-xl bold" style="margin:5px 0 15px 0;">${formatMoney(totalBalance)}</div>
                    <div class="flex gap-2">
                        <div style="flex:1; background:rgba(255,255,255,0.2); padding:10px; border-radius:10px;">
                            <div class="text-sm text-sub" style="color:rgba(255,255,255,0.8)" data-i18n="income">${i18n[lang].income}</div>
                            <div class="bold">${formatMoney(inc)}</div>
                        </div>
                        <div style="flex:1; background:rgba(255,255,255,0.2); padding:10px; border-radius:10px;">
                            <div class="text-sm text-sub" style="color:rgba(255,255,255,0.8)" data-i18n="expense">${i18n[lang].expense}</div>
                            <div class="bold">${formatMoney(exp)}</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-lg bold" style="margin-bottom:10px;" data-i18n="wallet">${i18n[lang].wallet}</h3>
                    ${accountsHtml}
                </div>

                <div class="card">
                    <h3 class="text-lg bold" style="margin-bottom:10px;" data-i18n="recent">${i18n[lang].recent}</h3>
                    <div id="recentTxList"></div>
                </div>
            `;
            renderTxList(transactions.slice(-5).reverse(), document.getElementById('recentTxList'));
        }

        function renderHistory(target) {
            target.innerHTML = `
                <div class="card">
                    <h3 class="text-lg bold" style="margin-bottom:10px;" data-i18n="history">${i18n[lang].history}</h3>
                    <div id="fullTxList"></div>
                </div>
            `;
            renderTxList(transactions.slice().reverse(), document.getElementById('fullTxList'));
        }

        function renderSettings(target) {
            target.innerHTML = `
                <div class="card">
                    <h3 class="text-lg bold" data-i18n="settings">${i18n[lang].settings}</h3>
                    <div style="margin-top:20px;">
                        <button class="btn btn-outline" onclick="exportData()" data-i18n="export" style="margin-bottom:10px;">${i18n[lang].export}</button>
                        <button class="btn" style="background:var(--danger); color:white;" onclick="resetData()" data-i18n="reset">${i18n[lang].reset}</button>
                    </div>
                </div>
            `;
        }

        function renderTxList(list, el) {
            if(!list.length) { el.innerHTML = '<div class="text-center text-sub" style="padding:10px;">No Data</div>'; return; }
            el.innerHTML = list.map(t => `
                <div class="tx-item">
                    <div class="tx-icon">${t.icon || 'ðŸ“„'}</div>
                    <div style="flex:1;">
                        <div class="text-base bold">${t.desc || t.category}</div>
                        <div class="text-sm text-sub">${t.accountName} â€¢ ${t.date}</div>
                    </div>
                    <div class="bold ${t.type === 'exp' ? 'text-red' : t.type === 'inc' ? 'text-green' : ''}">
                        ${t.type === 'exp' ? '-' : t.type === 'inc' ? '+' : ''}${formatMoney(t.amount)}
                    </div>
                </div>
            `).join('');
        }

        // --- MODAL ACTIONS ---
        function openTxModal() {
            setTxType('exp');
            populateSelect('txAccount', accounts.map(a => a.name));
            populateSelect('txCategory', categories.exp);
            document.getElementById('txModal').classList.add('open');
        }

        function openTransferModal() {
            populateSelect('trFrom', accounts.map(a => a.name));
            populateSelect('trTo', accounts.map(a => a.name));
            document.getElementById('transferModal').classList.add('open');
        }

        function closeModal(id) { document.getElementById(id).classList.remove('open'); }

        function setTxType(type) {
            txType = type;
            document.getElementById('btn-exp').style.background = type === 'exp' ? 'var(--danger)' : 'transparent';
            document.getElementById('btn-exp').style.color = type === 'exp' ? 'white' : 'var(--text)';
            document.getElementById('btn-inc').style.background = type === 'inc' ? 'var(--success)' : 'transparent';
            document.getElementById('btn-inc').style.color = type === 'inc' ? 'white' : 'var(--text)';
            populateSelect('txCategory', categories[type]);
        }

        function saveTransaction() {
            const amt = parseFloat(document.getElementById('txAmount').value);
            const accName = document.getElementById('txAccount').value;
            const cat = document.getElementById('txCategory').value;
            const desc = document.getElementById('txDesc').value;

            if(!amt || !accName) return alert('Please enter amount and wallet');

            // Update Account Balance
            const acc = accounts.find(a => a.name === accName);
            if(txType === 'exp') acc.balance -= amt;
            else acc.balance += amt;

            transactions.push({
                type: txType, amount: amt, accountName: accName, category: cat,
                desc: desc || cat, date: new Date().toLocaleDateString(),
                icon: cat.split(' ')[0]
            });

            saveData();
            closeModal('txModal');
            switchView(document.getElementById('nav-dash').classList.contains('active') ? 'dashboard' : 'transactions');
        }

        function saveTransfer() {
            const amt = parseFloat(document.getElementById('trAmount').value);
            const fromName = document.getElementById('trFrom').value;
            const toName = document.getElementById('trTo').value;

            if(!amt || fromName === toName) return alert('Invalid transfer');

            const fromAcc = accounts.find(a => a.name === fromName);
            const toAcc = accounts.find(a => a.name === toName);

            if(fromAcc.balance < amt) return alert('Insufficient funds');

            fromAcc.balance -= amt;
            toAcc.balance += amt;

            transactions.push({
                type: 'tr', amount: amt, accountName: `${fromName} âž ${toName}`,
                category: 'Transfer', desc: 'Internal Transfer', date: new Date().toLocaleDateString(),
                icon: 'â‡„'
            });

            saveData();
            closeModal('transferModal');
            switchView('dashboard');
        }

        // --- UTILS ---
        function populateSelect(id, items) {
            document.getElementById(id).innerHTML = items.map(i => `<option value="${i}">${i}</option>`).join('');
        }

        function formatMoney(n) { return n.toLocaleString('en-US') + ' ' + currency; }

        function saveData() {
            localStorage.setItem('mf_accounts', JSON.stringify(accounts));
            localStorage.setItem('mf_tx', JSON.stringify(transactions));
        }

        function exportData() {
            const data = JSON.stringify({ accounts, transactions });
            const blob = new Blob([data], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'finance_backup.json';
            a.click();
        }

        function resetData() {
            if(confirm('Delete all data?')) {
                localStorage.removeItem('mf_accounts');
                localStorage.removeItem('mf_tx');
                location.reload();
            }
        }

        // --- LANGUAGE & THEME ---
        function toggleLang() {
            lang = lang === 'en' ? 'ar' : 'en';
            localStorage.setItem('mf_lang', lang);
            updateLangAttrs();
            applyTranslations();
            switchView(document.querySelector('.nav-item.active').id === 'nav-dash' ? 'dashboard' : 'transactions');
        }

        function updateLangAttrs() {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }

        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(i18n[lang][key]) el.innerText = i18n[lang][key];
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }
    </script>
</body>
</html>
